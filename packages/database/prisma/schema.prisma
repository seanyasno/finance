generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["public"]
}

model users {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  updated_at    DateTime        @default(now()) @db.Timestamptz(6)
  email         String          @unique @db.VarChar(255)
  password      String          @db.VarChar(255)
  firstName     String?         @db.VarChar(100)
  lastName      String?         @db.VarChar(100)
  transactions  transactions[]
  bank_accounts bank_accounts[]
  credit_cards  credit_cards[]
  categories    categories[]

  @@schema("public")
}

model transactions {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at        DateTime           @default(now()) @db.Timestamptz(6)
  updated_at        DateTime           @default(now()) @db.Timestamptz(6)
  user_id           String             @db.Uuid
  description       String?
  timestamp         DateTime
  notes             String?
  metadata          Json?
  is_recurring      Boolean            @default(false)
  status            transaction_status
  installments      Json?
  original_amount   Float
  original_currency String
  charged_amount    Float
  charged_currency  String?
  source            transaction_source
  identifier        String             @unique @db.VarChar(255)

  bank_account_id String?        @db.Uuid
  bank_account    bank_accounts? @relation(fields: [bank_account_id], references: [id])
  user            users?         @relation(fields: [user_id], references: [id])
  credit_card_id  String?        @db.Uuid
  credit_card     credit_cards?  @relation(fields: [credit_card_id], references: [id])

  @@index([user_id])
  @@index([timestamp(sort: Desc)])
  @@index([identifier])
  @@schema("public")
}

enum transaction_status {
  completed
  pending

  @@schema("public")
}

enum transaction_source {
  bank_account
  credit_card

  @@schema("public")
}

model bank_accounts {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at     DateTime     @default(now()) @db.Timestamptz(6)
  updated_at     DateTime     @default(now()) @db.Timestamptz(6)
  user_id        String       @db.Uuid
  account_number String       @db.VarChar(50)
  balance        Float        @default(0.0)
  company        bank_company

  transactions transactions[]
  user         users          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, account_number])
  @@index([user_id])
  @@schema("public")
}

enum bank_company {
  discount
  oneZero

  @@schema("public")
}

model credit_cards {
  id          String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at  DateTime            @default(now()) @db.Timestamptz(6)
  updated_at  DateTime            @default(now()) @db.Timestamptz(6)
  user_id     String              @db.Uuid
  card_number String              @db.VarChar(20)
  company     credit_card_company

  transactions transactions[]
  user         users          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, card_number])
  @@index([user_id])
  @@schema("public")
}

enum credit_card_company {
  max
  isracard
  visaCal

  @@schema("public")
}

model categories {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @default(now()) @db.Timestamptz(6)
  name       String   @db.VarChar(50)
  icon       String?  @db.VarChar(50)
  color      String?  @db.VarChar(7)
  is_default Boolean  @default(false)
  user_id    String?  @db.Uuid

  user users? @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, name])
  @@index([user_id])
  @@schema("public")
}
