---
phase: 08-multiple-grouping-modes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/finance/finance/Generated/CustomModels.swift
autonomous: true

must_haves:
  truths:
    - "GroupingMode enum exists with date, creditCard, and month cases"
    - "Transaction model has computed properties for card and month grouping keys"
    - "DateFormatting has utility methods for month-based section headers"
  artifacts:
    - path: "apps/finance/finance/Generated/CustomModels.swift"
      provides: "GroupingMode enum, card/month grouping extensions"
      contains: "enum GroupingMode"
  key_links:
    - from: "GroupingMode"
      to: "Transaction extensions"
      via: "grouping key computed properties"
      pattern: "cardGroupingKey|monthGroupingKey"
---

<objective>
Add grouping infrastructure for multiple transaction grouping modes.

Purpose: Enable switching between date/card/month grouping by providing the enum and computed properties needed for each grouping strategy.
Output: GroupingMode enum and Transaction extensions with grouping keys for all three modes.
</objective>

<execution_context>
@/Users/seanyasno/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seanyasno/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-multiple-grouping-modes/08-CONTEXT.md
@apps/finance/finance/Generated/CustomModels.swift
@apps/finance/finance/Generated/ModelExtensions.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GroupingMode enum and Transaction grouping extensions</name>
  <files>apps/finance/finance/Generated/CustomModels.swift</files>
  <action>
Add a GroupingMode enum to CustomModels.swift with three cases: date, creditCard, month.
- Conform to String, CaseIterable for easy iteration and UserDefaults storage
- Add displayName computed property for UI labels: "Date", "Card", "Month"
- Add iconName computed property for SF Symbols: "calendar", "creditcard", "calendar.badge.clock" (or appropriate icons)

Add to DateFormatting enum:
- monthGroupingKey(_ date: Date) -> String: Returns "YYYY-MM" format string for grouping
- monthSectionHeader(for date: Date) -> String: Returns "February 2026" format (month + year)
- Add a static let monthYearFormatter: DateFormatter with format "MMMM yyyy"

Add Transaction extensions in ModelExtensions.swift (or keep in same file for coherence):
- cardGroupingKey: String - Returns creditCard?.id ?? "unknown" for grouping by card
- cardSectionHeader: String - Returns creditCard display name (e.g., "Max ****1234") or "Unknown Card"
- monthGroupingKey: String - Uses DateFormatting.monthGroupingKey(date)
- monthSectionHeader: String - Uses DateFormatting.monthSectionHeader(for: date)

Decisions made:
- Card sections ordered by card ID (stable order, alphabetically if needed)
- Month header shows full month name + year (e.g., "February 2026")
- Unknown cards grouped together under "Unknown Card"
  </action>
  <verify>
Build iOS app with: cd apps/finance && xcodebuild -scheme finance -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | tail -20
Verify no compiler errors.
  </verify>
  <done>
GroupingMode enum exists with date/creditCard/month cases. Transaction has cardGroupingKey, cardSectionHeader, monthGroupingKey, monthSectionHeader computed properties. DateFormatting has monthGroupingKey and monthSectionHeader utilities.
  </done>
</task>

</tasks>

<verification>
- iOS build succeeds without errors
- GroupingMode.allCases returns [.date, .creditCard, .month]
- GroupingMode has displayName and iconName properties
- Transaction model has all four new computed properties
- DateFormatting has monthGroupingKey and monthSectionHeader methods
</verification>

<success_criteria>
- Build passes with no compiler errors
- All new types and extensions are properly typed and accessible
- No warnings related to new code
</success_criteria>

<output>
After completion, create `.planning/phases/08-multiple-grouping-modes/08-01-SUMMARY.md`
</output>
