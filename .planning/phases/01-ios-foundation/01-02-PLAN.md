---
phase: 01-ios-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - apps/finance/finance/Views/Auth/LoginView.swift
  - apps/finance/finance/Views/Auth/RegisterView.swift
  - apps/finance/finance/Views/HomeView.swift
  - apps/finance/finance/Views/RootView.swift
  - apps/finance/finance/financeApp.swift
  - apps/finance/finance/ContentView.swift
autonomous: false

must_haves:
  truths:
    - "User can see login screen when not authenticated"
    - "User can enter email and password to log in"
    - "User can navigate to register screen from login"
    - "User can register with email, password, and optional names"
    - "User sees home screen after successful login"
    - "User can log out and return to login screen"
    - "Auth state persists across app restarts"
  artifacts:
    - path: "apps/finance/finance/Views/Auth/LoginView.swift"
      provides: "Login form with email/password fields"
      min_lines: 50
    - path: "apps/finance/finance/Views/Auth/RegisterView.swift"
      provides: "Registration form with email/password/name fields"
      min_lines: 50
    - path: "apps/finance/finance/Views/HomeView.swift"
      provides: "Authenticated home screen with user info and logout"
      min_lines: 30
    - path: "apps/finance/finance/Views/RootView.swift"
      provides: "Root navigation switching between auth and home"
      min_lines: 20
  key_links:
    - from: "apps/finance/finance/Views/Auth/LoginView.swift"
      to: "apps/finance/finance/Services/AuthManager.swift"
      via: "AuthManager.login() call on form submit"
      pattern: "authManager\\.login"
    - from: "apps/finance/finance/Views/Auth/RegisterView.swift"
      to: "apps/finance/finance/Services/AuthManager.swift"
      via: "AuthManager.register() call on form submit"
      pattern: "authManager\\.register"
    - from: "apps/finance/finance/Views/RootView.swift"
      to: "apps/finance/finance/Services/AuthManager.swift"
      via: "Observes isAuthenticated to switch views"
      pattern: "authManager\\.isAuthenticated"
---

<objective>
Build the authentication UI and navigation flow for the iOS app.

Purpose: Create the user-facing views that allow login, registration, and authenticated navigation, completing the authentication feature end-to-end.

Output: Working SwiftUI views for login, register, and home screens with navigation based on auth state.
</objective>

<execution_context>
@/Users/seanyasno/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seanyasno/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-ios-foundation/01-01-SUMMARY.md

AuthManager from Plan 01 provides:
- `@Published var currentUser: User?`
- `@Published var isLoading: Bool`
- `@Published var error: String?`
- `var isAuthenticated: Bool`
- `func login(email: String, password: String) async throws`
- `func register(email: String, password: String, firstName: String?, lastName: String?) async throws`
- `func logout() async`

Follow iOS design patterns:
- Use Form for input collection
- Use NavigationStack for navigation
- Use @EnvironmentObject for AuthManager access
- Use native iOS components (TextField, SecureField, Button)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LoginView</name>
  <files>
    apps/finance/finance/Views/Auth/LoginView.swift
  </files>
  <action>
Create Views/Auth directory and LoginView SwiftUI view.

LoginView struct:
- `@EnvironmentObject var authManager: AuthManager`
- `@State private var email: String = ""`
- `@State private var password: String = ""`
- `@Binding var showRegister: Bool` (to navigate to register)

Body:
- NavigationStack wrapping content
- VStack with:
  - App title/logo text ("Finance" with large title font)
  - Spacer
  - Form containing:
    - TextField for email (keyboard type: .emailAddress, autocapitalization: .never)
    - SecureField for password
  - If authManager.error is not nil, show error Text in red
  - Button "Login" that:
    - Is disabled when email or password is empty, or authManager.isLoading
    - Shows ProgressView when isLoading
    - Calls Task { try await authManager.login(email: email, password: password) } on tap
  - Button "Don't have an account? Register" that sets showRegister = true
  - Spacer

Style notes:
- Use .textFieldStyle(.roundedBorder) or Form styling
- Login button should be prominent (.buttonStyle(.borderedProminent))
- Center content vertically with appropriate padding
  </action>
  <verify>
Build succeeds with LoginView present.
  </verify>
  <done>
LoginView displays email/password form and calls AuthManager.login on submit.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create RegisterView</name>
  <files>
    apps/finance/finance/Views/Auth/RegisterView.swift
  </files>
  <action>
Create RegisterView SwiftUI view in Views/Auth directory.

RegisterView struct:
- `@EnvironmentObject var authManager: AuthManager`
- `@State private var email: String = ""`
- `@State private var password: String = ""`
- `@State private var confirmPassword: String = ""`
- `@State private var firstName: String = ""`
- `@State private var lastName: String = ""`
- `@Binding var showRegister: Bool` (to navigate back to login)

Body:
- NavigationStack wrapping content
- VStack with:
  - Title "Create Account" (large title)
  - Spacer
  - Form containing:
    - Section "Account":
      - TextField for email (keyboard type: .emailAddress, autocapitalization: .never)
      - SecureField for password
      - SecureField for confirm password
    - Section "Profile (Optional)":
      - TextField for first name
      - TextField for last name
  - If passwords don't match, show validation error
  - If authManager.error is not nil, show error Text in red
  - Button "Create Account" that:
    - Is disabled when email or password empty, passwords don't match, or isLoading
    - Shows ProgressView when isLoading
    - Calls Task { try await authManager.register(email: email, password: password, firstName: firstName.isEmpty ? nil : firstName, lastName: lastName.isEmpty ? nil : lastName) }
  - Button "Already have an account? Login" that sets showRegister = false
  - Spacer

Validation:
- Password must be at least 6 characters (match API requirement)
- Passwords must match
  </action>
  <verify>
Build succeeds with RegisterView present.
  </verify>
  <done>
RegisterView displays registration form and calls AuthManager.register on submit.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create HomeView and RootView</name>
  <files>
    apps/finance/finance/Views/HomeView.swift
    apps/finance/finance/Views/RootView.swift
  </files>
  <action>
Create HomeView for authenticated users and RootView for navigation.

HomeView struct:
- `@EnvironmentObject var authManager: AuthManager`

Body:
- NavigationStack with:
  - VStack:
    - Text "Welcome!" (title)
    - If currentUser exists:
      - Text showing user's email
      - If firstName/lastName exist, show full name
    - Spacer
    - Text "Your transactions will appear here" (placeholder for Phase 2)
    - Spacer
  - .toolbar with:
    - ToolbarItem(placement: .navigationBarTrailing):
      - Button "Logout" that calls Task { await authManager.logout() }

RootView struct:
- `@StateObject private var authManager = AuthManager()`
- `@State private var showRegister = false`

Body:
- Group:
  - If authManager.isAuthenticated:
    - HomeView()
  - Else:
    - If showRegister:
      - RegisterView(showRegister: $showRegister)
    - Else:
      - LoginView(showRegister: $showRegister)
- .environmentObject(authManager)

On appear:
- If not authenticated and token exists in keychain, show loading indicator while checking auth
  </action>
  <verify>
Build succeeds with both views. RootView switches between login/home based on auth state.
  </verify>
  <done>
RootView navigates between auth views and HomeView based on authentication state.
  </done>
</task>

<task type="auto">
  <name>Task 4: Update app entry point</name>
  <files>
    apps/finance/finance/financeApp.swift
    apps/finance/finance/ContentView.swift
  </files>
  <action>
Update financeApp.swift to use RootView as the main view.

financeApp.swift changes:
- Remove SwiftData ModelContainer setup (not needed - we're using API, not local persistence)
- Remove .modelContainer modifier
- Change WindowGroup to show RootView() instead of ContentView()

Clean up:
- Delete Item.swift (SwiftData template file, not needed)
- ContentView.swift can be deleted or kept empty - it's no longer used

Final financeApp.swift:
```swift
import SwiftUI

@main
struct financeApp: App {
    var body: some Scene {
        WindowGroup {
            RootView()
        }
    }
}
```
  </action>
  <verify>
App launches and shows LoginView. Build succeeds.
  </verify>
  <done>
App entry point uses RootView, SwiftData removed, app launches to login screen.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete iOS authentication flow: Login view, Register view, Home view with logout, and navigation based on auth state.
  </what-built>
  <how-to-verify>
1. Start the NestJS API: `cd apps/api && npm run dev` (should run on port 3100)
2. Open Xcode project: `open apps/finance/finance.xcodeproj`
3. Run the app on iOS Simulator
4. Verify login screen appears on launch
5. Tap "Don't have an account? Register" - should show register form
6. Create a new account with email/password
7. After registration, should see home screen with welcome message
8. Tap logout - should return to login screen
9. Login with the account you just created
10. Force-quit the app and relaunch - should still be logged in (token persisted)

Expected behavior:
- Native iOS styling (no custom UI framework)
- Loading indicators during API calls
- Error messages on invalid credentials
- Smooth transitions between views
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. App builds without errors
2. LoginView accepts email/password and submits to API
3. RegisterView accepts registration data and submits to API
4. RootView switches between auth and home based on isAuthenticated
5. Auth token persists in Keychain across app restarts
6. All views use native SwiftUI components
</verification>

<success_criteria>
- [ ] User can see login screen on app launch (when not authenticated)
- [ ] User can enter email and password in login form
- [ ] User can navigate to registration from login
- [ ] User can register with email, password, and optional name
- [ ] User sees home screen after successful login/register
- [ ] User can log out and return to login screen
- [ ] Auth state persists across app restarts (Keychain token)
- [ ] All views follow iOS design patterns (Form, NavigationStack, native components)
</success_criteria>

<output>
After completion, create `.planning/phases/01-ios-foundation/01-02-SUMMARY.md`
</output>
