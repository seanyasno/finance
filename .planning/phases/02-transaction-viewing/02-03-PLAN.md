---
phase: 02-transaction-viewing
plan: 03
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - apps/finance/finance/Views/Transactions/TransactionListView.swift
  - apps/finance/finance/Views/Transactions/TransactionRowView.swift
  - apps/finance/finance/Views/Transactions/TransactionFilterView.swift
  - apps/finance/finance/Views/HomeView.swift
  - apps/finance/finance/financeApp.swift
autonomous: false

must_haves:
  truths:
    - "User can see list of transactions after logging in"
    - "User can filter transactions by date range using date pickers"
    - "User can filter transactions by selecting a credit card"
    - "Transaction list shows card name, merchant, amount, and date"
    - "Clearing filters shows all transactions again"
  artifacts:
    - path: "apps/finance/finance/Views/Transactions/TransactionListView.swift"
      provides: "Main transaction list screen"
      contains: "struct TransactionListView"
    - path: "apps/finance/finance/Views/Transactions/TransactionRowView.swift"
      provides: "Individual transaction row"
      contains: "struct TransactionRowView"
    - path: "apps/finance/finance/Views/Transactions/TransactionFilterView.swift"
      provides: "Filter controls sheet"
      contains: "struct TransactionFilterView"
  key_links:
    - from: "apps/finance/finance/Views/Transactions/TransactionListView.swift"
      to: "apps/finance/finance/Services/TransactionService.swift"
      via: "@StateObject"
      pattern: "@StateObject.*TransactionService"
    - from: "apps/finance/finance/Views/HomeView.swift"
      to: "apps/finance/finance/Views/Transactions/TransactionListView.swift"
      via: "view composition"
      pattern: "TransactionListView"
    - from: "apps/finance/finance/Views/Transactions/TransactionFilterView.swift"
      to: "apps/finance/finance/Models/CreditCard.swift"
      via: "Picker data"
      pattern: "Picker.*creditCards"
---

<objective>
Create SwiftUI views for transaction list with filtering capabilities.

Purpose: Complete the transaction viewing feature - users see their transactions and can filter by date/card
Output: TransactionListView with filter sheet, integrated into HomeView
</objective>

<execution_context>
@/Users/seanyasno/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seanyasno/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase UI patterns
@.planning/phases/01-ios-foundation/01-02-SUMMARY.md

# Plan 02 models and service (dependency)
@apps/finance/finance/Models/Transaction.swift
@apps/finance/finance/Models/CreditCard.swift
@apps/finance/finance/Services/TransactionService.swift

# Existing UI patterns
@apps/finance/finance/Views/HomeView.swift
@apps/finance/finance/Views/Auth/LoginView.swift
@apps/finance/finance/financeApp.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Transaction Row and List Views</name>
  <files>
    apps/finance/finance/Views/Transactions/TransactionRowView.swift
    apps/finance/finance/Views/Transactions/TransactionListView.swift
  </files>
  <action>
Create the transaction list UI components:

1. **TransactionRowView.swift** - Individual transaction row:
   ```swift
   struct TransactionRowView: View {
       let transaction: Transaction

       var body: some View {
           HStack {
               VStack(alignment: .leading, spacing: 4) {
                   Text(transaction.merchantName)
                       .font(.headline)
                   HStack(spacing: 8) {
                       if let card = transaction.creditCard {
                           Text(card.cardNumber.suffix(4))
                               .font(.caption)
                               .foregroundColor(.secondary)
                       }
                       Text(transaction.formattedDate)
                           .font(.caption)
                           .foregroundColor(.secondary)
                   }
               }
               Spacer()
               Text(transaction.formattedAmount)
                   .font(.body)
                   .fontWeight(.medium)
           }
           .padding(.vertical, 4)
       }
   }
   ```

2. **TransactionListView.swift** - Main list view:
   ```swift
   struct TransactionListView: View {
       @StateObject private var transactionService = TransactionService()
       @State private var showFilters = false
       @State private var startDate: Date? = nil
       @State private var endDate: Date? = nil
       @State private var selectedCardId: String? = nil

       var body: some View {
           Group {
               if transactionService.isLoading {
                   ProgressView("Loading transactions...")
               } else if let error = transactionService.error {
                   VStack { ... error display with retry button }
               } else if transactionService.transactions.isEmpty {
                   ContentUnavailableView("No Transactions",
                       systemImage: "creditcard",
                       description: Text("Your transactions will appear here"))
               } else {
                   List(transactionService.transactions) { transaction in
                       TransactionRowView(transaction: transaction)
                   }
               }
           }
           .navigationTitle("Transactions")
           .toolbar { ... filter button }
           .sheet(isPresented: $showFilters) { ... filter view }
           .task { await loadData() }
       }

       private func loadData() async { ... }
       private func applyFilters() async { ... }
   }
   ```

Features to include:
- Pull-to-refresh on the list
- Loading state with ProgressView
- Empty state with ContentUnavailableView
- Error state with retry button
- Toolbar button to open filter sheet
- Filter badge showing active filter count
  </action>
  <verify>
Build iOS project in Xcode (Cmd+B). No compilation errors.
  </verify>
  <done>
TransactionListView displays transactions with rows showing merchant, card, amount, date. Loading and error states handled.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Filter View</name>
  <files>
    apps/finance/finance/Views/Transactions/TransactionFilterView.swift
  </files>
  <action>
Create the filter sheet view:

1. **TransactionFilterView.swift**:
   ```swift
   struct TransactionFilterView: View {
       @Binding var startDate: Date?
       @Binding var endDate: Date?
       @Binding var selectedCardId: String?
       let creditCards: [CreditCard]
       let onApply: () -> Void
       let onClear: () -> Void
       @Environment(\.dismiss) private var dismiss

       var body: some View {
           NavigationStack {
               Form {
                   Section("Date Range") {
                       DatePicker(...)  // Start date toggle + picker
                       DatePicker(...)  // End date toggle + picker
                   }

                   Section("Credit Card") {
                       Picker("Card", selection: $selectedCardId) {
                           Text("All Cards").tag(nil as String?)
                           ForEach(creditCards) { card in
                               Text("****\(card.cardNumber.suffix(4)) (\(card.company))")
                                   .tag(card.id as String?)
                           }
                       }
                   }
               }
               .navigationTitle("Filters")
               .navigationBarTitleDisplayMode(.inline)
               .toolbar {
                   ToolbarItem(placement: .cancellationAction) {
                       Button("Clear") { onClear(); dismiss() }
                   }
                   ToolbarItem(placement: .confirmationAction) {
                       Button("Apply") { onApply(); dismiss() }
                   }
               }
           }
       }
   }
   ```

Features:
- Toggle for enabling start date filter (nil = no filter)
- Toggle for enabling end date filter
- DatePicker shows when toggle is on
- Card picker with "All Cards" option (nil) and list of user's cards
- Clear button resets all filters
- Apply button triggers filter callback
  </action>
  <verify>
Build iOS project in Xcode (Cmd+B). No compilation errors.
  </verify>
  <done>
TransactionFilterView provides date range and credit card filter controls with Apply/Clear actions.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate into HomeView and App Entry</name>
  <files>
    apps/finance/finance/Views/HomeView.swift
    apps/finance/finance/financeApp.swift
  </files>
  <action>
Replace HomeView placeholder with TransactionListView:

1. **HomeView.swift** - Update to show transactions:
   - Remove the placeholder text "Your transactions will appear here"
   - Replace content with TransactionListView()
   - Keep the welcome header and logout button in toolbar
   - Structure:
     ```swift
     NavigationStack {
         TransactionListView()
             .toolbar {
                 ToolbarItem(placement: .navigationBarTrailing) {
                     Button("Logout") { ... }
                 }
             }
     }
     ```
   - Remove the inner NavigationStack from TransactionListView if nested issue

2. **financeApp.swift** - Ensure TransactionService is available:
   - If needed, add TransactionService to environment
   - Or keep it as @StateObject in TransactionListView (simpler)

Note: TransactionListView already creates its own TransactionService via @StateObject, so no changes needed to financeApp.swift unless we want shared state.
  </action>
  <verify>
Build iOS project (Cmd+B). App compiles without errors.
  </verify>
  <done>
HomeView now displays TransactionListView instead of placeholder. Navigation structure works correctly.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 4: Verify Complete Transaction Viewing Flow</name>
  <what-built>
Complete transaction viewing feature:
- API endpoints for transactions and credit cards (Plan 01)
- iOS models and service layer (Plan 02)
- Transaction list UI with filtering (Plan 03)
  </what-built>
  <how-to-verify>
1. Start the API: `cd apps/api && npm run start:dev`
2. Run iOS app in Simulator (Xcode > Run or Cmd+R)
3. Login with existing credentials (or register new account)
4. After login, verify:
   - Transaction list appears (or empty state if no transactions)
   - Each transaction shows: merchant name, card last 4 digits, date, amount
5. Test date filter:
   - Tap filter button in toolbar
   - Enable "Start Date" toggle and pick a date
   - Tap "Apply"
   - Verify list updates to show only transactions after that date
6. Test card filter:
   - Open filters again
   - Select a specific credit card from picker
   - Tap "Apply"
   - Verify list shows only transactions from that card
7. Test clear filters:
   - Open filters
   - Tap "Clear"
   - Verify all transactions appear again

Note: If no transactions exist in database, the empty state should display correctly. The transaction scraper populates data - this UI just displays it.
  </how-to-verify>
  <resume-signal>Type "approved" if all verification steps pass, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
1. Xcode builds without errors (Cmd+B)
2. App runs in Simulator without crashes
3. After login, transaction list displays (or empty state)
4. Each transaction row shows: merchant, card, amount, date
5. Filter sheet opens from toolbar button
6. Date filters work (start date, end date)
7. Card filter works (filters to selected card)
8. Clear filters resets to show all transactions
9. Pull-to-refresh reloads data
10. Error handling works (shows error message with retry)
</verification>

<success_criteria>
- User can see list of all transactions from database in iOS app
- User can filter transactions by date range (start/end dates)
- User can filter transactions by credit card
- Transaction list displays card name, merchant, amount, and date
- All Phase 2 success criteria from ROADMAP.md are met
</success_criteria>

<output>
After completion, create `.planning/phases/02-transaction-viewing/02-03-SUMMARY.md`
</output>
