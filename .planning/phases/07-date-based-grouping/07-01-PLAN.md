---
phase: 07-date-based-grouping
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/finance/finance/Generated/CustomModels.swift
  - apps/finance/finance/Generated/ModelExtensions.swift
autonomous: true

must_haves:
  truths:
    - "All dates in the app display in DD/MM/YY format"
    - "Date formatters are cached for scrolling performance"
    - "Transactions can be grouped by calendar date"
    - "Today and Yesterday are detectable for relative date display"
  artifacts:
    - path: "apps/finance/finance/Generated/CustomModels.swift"
      provides: "Cached DateFormatter instances and DateFormatting utility"
      contains: "DateFormatting"
    - path: "apps/finance/finance/Generated/ModelExtensions.swift"
      provides: "Updated formattedDate using DD/MM/YY format, date grouping key"
      contains: "dd/MM/yy"
  key_links:
    - from: "apps/finance/finance/Generated/ModelExtensions.swift"
      to: "apps/finance/finance/Generated/CustomModels.swift"
      via: "DateFormatting utility usage"
      pattern: "DateFormatting\\."
---

<objective>
Create date formatting infrastructure with cached formatters and DD/MM/YY format.

Purpose: Establish consistent date formatting across the app with proper performance characteristics. Cached formatters avoid performance degradation during list scrolling.

Output: DateFormatting utility with cached formatters, updated Transaction extension with DD/MM/YY format and grouping support.
</objective>

<execution_context>
@/Users/seanyasno/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seanyasno/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-date-based-grouping/07-CONTEXT.md

@apps/finance/finance/Generated/CustomModels.swift
@apps/finance/finance/Generated/ModelExtensions.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DateFormatting utility with cached formatters</name>
  <files>apps/finance/finance/Generated/CustomModels.swift</files>
  <action>
Add a DateFormatting enum/struct to CustomModels.swift with static cached formatters:

1. Create `DateFormatting` enum (use enum for namespace, no instances needed):
   - `static let shortDateFormatter`: DateFormatter with "dd/MM/yy" format
   - `static let iso8601Formatter`: ISO8601DateFormatter for parsing timestamps
   - `static let calendar`: Calendar.current cached reference

2. Add utility functions:
   - `static func formatShortDate(_ date: Date) -> String`: Returns date in DD/MM/YY format
   - `static func dateGroupingKey(_ date: Date) -> String`: Returns date-only string for grouping (e.g., "2026-02-02")
   - `static func relativeLabel(for date: Date) -> String?`: Returns "Today" or "Yesterday" if applicable, nil otherwise
   - `static func sectionHeader(for date: Date) -> String`: Returns relative label if available, otherwise DD/MM/YY format

Place after the existing TrendDirection enum.

Use static let for formatters (thread-safe lazy initialization in Swift).
  </action>
  <verify>
Build the iOS app: `cd /Users/seanyasno/Developer/finance/apps/finance && xcodebuild -scheme finance -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | head -50`

No build errors related to DateFormatting.
  </verify>
  <done>
DateFormatting utility exists with cached formatters for DD/MM/YY format, grouping keys, and relative date detection (Today/Yesterday).
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Transaction formattedDate to use DD/MM/YY format</name>
  <files>apps/finance/finance/Generated/ModelExtensions.swift</files>
  <action>
Update the Transaction extension in ModelExtensions.swift:

1. Update `formattedDate` computed property:
   - Use `DateFormatting.formatShortDate()` instead of creating a new DateFormatter
   - Result format: DD/MM/YY (e.g., "02/02/26")

2. Add new `dateGroupingKey` computed property:
   - Returns `DateFormatting.dateGroupingKey(date)` for use as Dictionary grouping key
   - This is a date-only string that groups transactions by calendar day

3. Add new `sectionHeaderTitle` computed property:
   - Returns `DateFormatting.sectionHeader(for: date)`
   - This returns "Today", "Yesterday", or DD/MM/YY format

The existing `date` computed property already parses the timestamp - reuse it.
  </action>
  <verify>
Build the iOS app: `cd /Users/seanyasno/Developer/finance/apps/finance && xcodebuild -scheme finance -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | head -50`

No build errors. Transaction extension compiles with new properties.
  </verify>
  <done>
Transaction.formattedDate returns DD/MM/YY format, Transaction.dateGroupingKey and Transaction.sectionHeaderTitle available for grouping UI.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds without errors
2. DateFormatting utility is accessible from ModelExtensions
3. Transaction.formattedDate returns DD/MM/YY format (e.g., "02/02/26")
4. Transaction.dateGroupingKey returns date-only string for grouping
5. Transaction.sectionHeaderTitle returns "Today", "Yesterday", or DD/MM/YY
</verification>

<success_criteria>
- Build passes with no errors
- Date formatting uses cached formatters (no new DateFormatter() in computed properties)
- DD/MM/YY format implemented consistently
- Relative date detection works for Today and Yesterday
- Grouping key available for Dictionary(grouping:by:) usage in next plan
</success_criteria>

<output>
After completion, create `.planning/phases/07-date-based-grouping/07-01-SUMMARY.md`
</output>
