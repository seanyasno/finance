---
phase: 07-date-based-grouping
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - apps/finance/finance/Views/Transactions/TransactionListView.swift
  - apps/finance/finance/Views/Transactions/TransactionDetailView.swift
autonomous: true

must_haves:
  truths:
    - "Transactions appear in sections with date headers"
    - "Recent transactions show relative dates (Today, Yesterday) as section headers"
    - "Older transactions show formatted dates (DD/MM/YY) as section headers"
    - "Transaction list items show dates in DD/MM/YY format"
    - "Transaction detail page shows dates in DD/MM/YY format"
    - "Search and filters work correctly with grouped list"
  artifacts:
    - path: "apps/finance/finance/Views/Transactions/TransactionListView.swift"
      provides: "Grouped transaction list with date sections"
      contains: "Section"
    - path: "apps/finance/finance/Views/Transactions/TransactionDetailView.swift"
      provides: "Detail view with DD/MM/YY date format"
      contains: "formattedDate"
  key_links:
    - from: "apps/finance/finance/Views/Transactions/TransactionListView.swift"
      to: "apps/finance/finance/Generated/ModelExtensions.swift"
      via: "Transaction grouping and section headers"
      pattern: "dateGroupingKey|sectionHeaderTitle"
---

<objective>
Implement grouped transaction list UI with date sections and relative date headers.

Purpose: Transform the flat transaction list into a sectioned list organized by date, with Today/Yesterday labels for recent transactions and DD/MM/YY format for older dates.

Output: TransactionListView with grouped sections, TransactionDetailView with consistent date formatting.
</objective>

<execution_context>
@/Users/seanyasno/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seanyasno/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-date-based-grouping/07-CONTEXT.md
@.planning/phases/07-date-based-grouping/07-01-SUMMARY.md

@apps/finance/finance/Views/Transactions/TransactionListView.swift
@apps/finance/finance/Views/Transactions/TransactionDetailView.swift
@apps/finance/finance/Generated/ModelExtensions.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement grouped transaction list with date sections</name>
  <files>apps/finance/finance/Views/Transactions/TransactionListView.swift</files>
  <action>
Update TransactionListView to display transactions in grouped sections by date:

1. Add computed property to group transactions:
   ```swift
   private var groupedTransactions: [(key: String, transactions: [Transaction])] {
       let grouped = Dictionary(grouping: transactionService.transactions) { $0.dateGroupingKey }
       return grouped.sorted { $0.key > $1.key } // Descending order (newest first)
   }
   ```

2. Replace the flat `List(transactionService.transactions)` with sectioned list:
   ```swift
   List {
       ForEach(groupedTransactions, id: \.key) { group in
           Section {
               ForEach(group.transactions) { transaction in
                   NavigationLink {
                       TransactionDetailView(
                           transaction: transaction,
                           transactionService: transactionService
                       )
                   } label: {
                       TransactionRowView(transaction: transaction)
                   }
               }
           } header: {
               // Use the first transaction's sectionHeaderTitle for the header
               if let firstTransaction = group.transactions.first {
                   Text(firstTransaction.sectionHeaderTitle)
               }
           }
       }
   }
   ```

3. Keep existing modifiers: `.refreshable`, `.searchable`, `.onChange`, `.toolbar`, `.sheet`, `.task`

4. Ensure empty states still work correctly (check transactions.isEmpty before grouping)

The grouping preserves:
- Search functionality (transactions array is already filtered)
- Date/card filters (transactions array is already filtered)
- Pull-to-refresh (loadData still works)
  </action>
  <verify>
Build the iOS app: `cd /Users/seanyasno/Developer/finance/apps/finance && xcodebuild -scheme finance -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | head -50`

No build errors related to TransactionListView.
  </verify>
  <done>
TransactionListView displays transactions grouped by date with section headers showing "Today", "Yesterday", or DD/MM/YY format.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify TransactionDetailView uses DD/MM/YY format</name>
  <files>apps/finance/finance/Views/Transactions/TransactionDetailView.swift</files>
  <action>
Verify TransactionDetailView already uses `transaction.formattedDate` which was updated in Plan 01 to use DD/MM/YY format.

The line should be:
```swift
LabeledContent("Date", value: transaction.formattedDate)
```

If the file still uses this pattern (it should), NO CHANGES NEEDED - just verify.

If for some reason it uses a different date formatting approach, update it to use `transaction.formattedDate`.
  </action>
  <verify>
Check that TransactionDetailView uses `transaction.formattedDate`:
`grep -n "formattedDate" apps/finance/finance/Views/Transactions/TransactionDetailView.swift`

Build verification: `cd /Users/seanyasno/Developer/finance/apps/finance && xcodebuild -scheme finance -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | head -50`
  </verify>
  <done>
TransactionDetailView displays date in DD/MM/YY format via transaction.formattedDate.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds without errors
2. Transaction list shows sections with date headers
3. Today's transactions show "Today" section header
4. Yesterday's transactions show "Yesterday" section header
5. Older transactions show DD/MM/YY format in section headers
6. Transaction row items show DD/MM/YY format (via formattedDate)
7. Transaction detail page shows DD/MM/YY format
8. Search works correctly with grouped list
9. Date/card filters work correctly with grouped list
10. Pull-to-refresh works correctly with grouped list
</verification>

<success_criteria>
- Build passes with no errors
- Transactions grouped by date in descending order (newest first)
- Section headers show relative dates (Today, Yesterday) for recent transactions
- Section headers show DD/MM/YY format for older transactions
- All existing functionality preserved (search, filters, refresh)
- Transaction detail shows date in DD/MM/YY format
</success_criteria>

<output>
After completion, create `.planning/phases/07-date-based-grouping/07-02-SUMMARY.md`
</output>
