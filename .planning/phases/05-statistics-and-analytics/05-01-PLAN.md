---
phase: 05-statistics-and-analytics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/api/package.json
  - apps/api/scripts/generate-swift.sh
  - apps/finance/finance/Generated/Models.swift
  - apps/finance/finance/Models/Transaction.swift
  - apps/finance/finance/Models/CreditCard.swift
  - apps/finance/finance/Models/Category.swift
  - apps/finance/finance/Models/BillingCycle.swift
  - apps/finance/finance/Models/AuthModels.swift
  - apps/finance/finance/Models/User.swift
  - apps/finance/finance/Services/TransactionService.swift
  - apps/finance/finance/Services/CategoryService.swift
autonomous: true

must_haves:
  truths:
    - "Running npm run generate:swift produces Swift models from OpenAPI spec"
    - "iOS app uses generated types instead of manual model definitions"
    - "Existing iOS functionality works unchanged after migration"
  artifacts:
    - path: "apps/api/scripts/generate-swift.sh"
      provides: "Shell script for Swift code generation"
      contains: "openapi-generator"
    - path: "apps/api/package.json"
      provides: "generate:swift npm script"
      contains: "generate:swift"
    - path: "apps/finance/finance/Generated/Models.swift"
      provides: "Generated Swift models from OpenAPI"
      min_lines: 50
  key_links:
    - from: "apps/api/package.json"
      to: "apps/api/scripts/generate-swift.sh"
      via: "npm script invokes shell script"
      pattern: "generate-swift"
    - from: "apps/finance/finance/Services/TransactionService.swift"
      to: "apps/finance/finance/Generated/Models.swift"
      via: "imports generated types"
      pattern: "Generated"
---

<objective>
Set up OpenAPI-to-Swift code generation and migrate existing iOS models to use generated types.

Purpose: Establish type-safe foundation where API changes automatically produce updated Swift models, eliminating manual type synchronization.

Output: Working `npm run generate:swift` command that produces Swift models used throughout the iOS app.
</objective>

<execution_context>
@/Users/seanyasno/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seanyasno/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/api/package.json
@apps/finance/finance/Models/Transaction.swift
@apps/finance/finance/Models/CreditCard.swift
@apps/finance/finance/Models/Category.swift
@apps/finance/finance/Services/TransactionService.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Swift code generation script and npm command</name>
  <files>
    apps/api/package.json
    apps/api/scripts/generate-swift.sh
  </files>
  <action>
1. Create `apps/api/scripts/generate-swift.sh`:
   - First, fetch OpenAPI JSON from running API server (http://localhost:3100/api-json)
   - Use openapi-generator-cli to generate Swift 5 models
   - Output to `../../apps/finance/finance/Generated/`
   - Use generator config: swift5, library=alamofire (or urlsession), modelPackage=Generated
   - Make script executable (chmod +x)

2. Add to package.json scripts:
   ```json
   "generate:swift": "bash scripts/generate-swift.sh"
   ```

3. The script should:
   - Check if API server is running (curl health check)
   - Create output directory if needed
   - Generate models only (--global-property models)
   - Clean previous generated files before regenerating
  </action>
  <verify>
    - `cat apps/api/scripts/generate-swift.sh` shows complete script
    - `grep "generate:swift" apps/api/package.json` shows script entry
    - Script is executable: `ls -la apps/api/scripts/generate-swift.sh`
  </verify>
  <done>
    npm run generate:swift command exists and script is ready to execute
  </done>
</task>

<task type="auto">
  <name>Task 2: Generate Swift models and migrate iOS codebase</name>
  <files>
    apps/finance/finance/Generated/Models.swift
    apps/finance/finance/Models/Transaction.swift
    apps/finance/finance/Models/CreditCard.swift
    apps/finance/finance/Models/Category.swift
    apps/finance/finance/Models/BillingCycle.swift
    apps/finance/finance/Models/AuthModels.swift
    apps/finance/finance/Models/User.swift
    apps/finance/finance/Services/TransactionService.swift
    apps/finance/finance/Services/CategoryService.swift
  </files>
  <action>
1. Start the API server if not running (cd apps/api && npm run dev &)
2. Wait for server to be ready (curl http://localhost:3100/api-json)
3. Run the generation: cd apps/api && npm run generate:swift

4. Review generated output in apps/finance/finance/Generated/
   - Check that Transaction, CreditCard, Category DTOs are generated
   - Note the exact type names and structure

5. Migrate iOS models to use generated types:

   **Option A (if generated types are directly usable):**
   - Update imports in service files to use Generated types
   - Remove duplicate model definitions
   - Keep computed properties (formattedAmount, displayName, etc.) as extensions

   **Option B (if generated types need adaptation):**
   - Keep Generated folder as reference/validation
   - Update manual models to match generated structure exactly
   - Add typealiases if naming differs

6. Preserve all computed properties that aren't in the API:
   - Transaction: formattedAmount, formattedDate, merchantName, date, categoryName
   - CreditCard: displayName, effectiveBillingCycleDay
   - Category: displayIcon, displayColor
   - BillingCycle: entire model (client-only)

7. Ensure all response wrapper types (TransactionsResponse, CreditCardsResponse, etc.) are compatible

8. Verify the iOS app builds successfully with Xcode or xcodebuild
  </action>
  <verify>
    - Generated folder exists: `ls apps/finance/finance/Generated/`
    - iOS app builds: `cd apps/finance && xcodebuild -scheme finance -destination 'platform=iOS Simulator,name=iPhone 15' build 2>&1 | tail -20`
    - Service files reference generated or compatible types
  </verify>
  <done>
    iOS app builds successfully using generated or generated-compatible types for API models
  </done>
</task>

</tasks>

<verification>
1. `npm run generate:swift` in apps/api succeeds (requires running API server)
2. Generated Swift files exist in apps/finance/finance/Generated/
3. iOS app builds without errors
4. Existing views (TransactionListView, BillingCycleView, CategoryListView) render correctly in preview
</verification>

<success_criteria>
- OpenAPI Swift generation pipeline is functional
- iOS models are synchronized with API DTOs
- All existing iOS functionality preserved
- Foundation ready for new Statistics API types
</success_criteria>

<output>
After completion, create `.planning/phases/05-statistics-and-analytics/05-01-SUMMARY.md`
</output>
